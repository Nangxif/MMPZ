$(function(){
    $("#register").on('click',function(){
        if($("#password").val()==$("#repassword").val()){
            $.ajax({
                type:'post',
                url:'/api/user/register',
                data:{
                    username:$("#username").val(),
                    mobilephone:$('#mobilephone').val(),
                    password:encrypt($("#password").val(),"nangxi"),
                    repassword:$("#repassword").val()
                },
                dataType:'json',
                success:function(result){
                    $('#Register-text').text(result.message);
                    //如果注册成功，那么跳转页面至首页
                    if(result.code==0){
                        $.ajax({
                            type:'post',
                            url:'/api/user/login',
                            data:{
                                username:$("#username").val(),
                                password:$("#password").val()
                            },
                            dataType:'json',
                            success:function(result){
                                $("#register_close").attr("data-dismiss","");
                                $("#register_close").attr("href","/user");
                            }
                        })
                    }else{//如果注册失败，则关闭弹框
                        $("#register_close").attr("data-dismiss","modal");
                    }
                }
            });
        }else{
            $('#Register-text').text("两次输入密码不一致,请核对后输入");
            $("#register_close").attr("data-dismiss","modal");
        }
    });

    $("#mobilephone").on('input propertychange',function(){
        if(/^1[3|4|5|7|8][0-9]{9}$/.test($("#mobilephone").val())){
            $("#mobilephone").css({"box-shadow":""});
            $("#register").removeAttr("disabled");
        }else{
            $("#mobilephone").css({"box-shadow":"0px 0px 11px #d0040a","border-radius":"1px"});
            $("#register").attr("disabled","disabled");
        }
    });
    $("#username").on("input propertychange",function(){
        if($("#username").val().length>=2){
            $("#username").css({"box-shadow":""});
            $("#register").removeAttr("disabled");
        }else{
            $("#username").css({"box-shadow":"0px 0px 11px #d0040a","border-radius":"1px"});
            $("#register").attr("disabled","disabled");
        }
    })
})